<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>HandyManager</title>
    <link rel="stylesheet" href="css/styles.css">
    <link rel="manifest" href="manifest.json">
    <meta name="theme-color" content="#4CAF50">
</head>
<body>
    <div class="container">
        <header>
            <h1>HandyManager</h1>
        </header>
        <main>
            <div id="settings-section">
                <h2>Settings</h2>
                <form id="settings-form">
                    <div class="form-group">
                        <label for="token">Token:</label>
                        <input type="password" id="token" required>
                    </div>
                    <div class="form-group">
                        <label for="rep-name">Rep Name:</label>
                        <input type="text" id="rep-name" required>
                    </div>
                    <button type="submit">Save Settings</button>
                </form>
                <div class="pwa-instructions-link">
                    <h3>Install as App</h3>
                    <div id="pwa-instructions">
                        <ul>
                            <li>
                                <strong>Android Chrome:</strong> Tap the menu (three dots) and select "Add to Home screen"
                                <br><button id="install-button" style="margin-top: 5px;">Install App (Android only)</button>
                            </li>
                            <li><strong>iOS Safari:</strong> Tap the share button and select "Add to Home Screen"</li>
                        </ul>
                        <p><em>Note: The install button only works on Android. iOS users must follow the manual instructions above.</em></p>
                    </div>
                </div>
            </div>

            <div id="jobs-section" style="display: none;">
                <div class="header-controls">
                    <h2>In Progress Jobs</h2>
                    <button id="settings-btn" class="secondary-btn">Settings</button>
                </div>
                <ul id="jobs-list"></ul>
                <button id="new-job-btn" class="primary-btn">Start New Job</button>
            </div>
        </main>
    </div>

    <script src="js/main.js"></script>
    <script>
        // Handle PWA installation
        let deferredPrompt;

        window.addEventListener('beforeinstallprompt', (e) => {
            // Prevent Chrome 67 and earlier from automatically showing the prompt
            e.preventDefault();
            // Stash the event so it can be triggered later
            deferredPrompt = e;
            // Show the install button
            const installButton = document.getElementById('install-button');
            installButton.style.display = 'block';
        });

        document.addEventListener('DOMContentLoaded', function() {
            const installButton = document.getElementById('install-button');

            // Handle install button click
            installButton.addEventListener('click', (e) => {
                // Hide the install button
                installButton.style.display = 'none';

                // Show the install prompt
                if (deferredPrompt) {
                    deferredPrompt.prompt();

                    // Wait for the user to respond to the prompt
                    deferredPrompt.userChoice.then((choiceResult) => {
                        if (choiceResult.outcome === 'accepted') {
                            console.log('User accepted the install prompt');
                        } else {
                            console.log('User dismissed the install prompt');
                        }
                        deferredPrompt = null;
                    });
                }
            });
        });
    </script>
</body>
</html>